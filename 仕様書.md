# 日商簿記3級 仕訳問題アプリ - 仕様書

## 1. アプリケーション概要

### 1.1 目的
日商簿記3級検定対策として、制限時間内に仕訳問題を解く練習を行うWebアプリケーション。

### 1.2 主要機能
- 15分以内に15問の仕訳問題を解答
- タイマー機能（カウントダウン）
- 正誤判定機能
- 正解・解説表示
- Gemini APIによる問題の自動生成

### 1.3 対象ユーザー
- 日商簿記3級の受験者
- 簿記の基礎を学習中の学生・社会人

---

## 2. 技術スタック

### 2.1 フロントエンド
- **フレームワーク**: Next.js 15.x (App Router)
- **UI**: React 18.x (関数コンポーネント)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS

### 2.2 バックエンド
- **API**: Next.js API Routes
- **外部API**: Google Gemini API (gemini-2.5-flash)

### 2.3 データ管理
- **問題データ**: ローカルJSON / Gemini API生成
- **状態管理**: React Hooks (useState, useEffect)
- **永続化**: sessionStorage

### 2.4 デプロイ
- **ホスティング**: Vercel
- **リポジトリ**: GitHub

---

## 3. 機能仕様

### 3.1 タイマー機能

#### 3.1.1 制限時間設定
- デフォルト: 15分
- 変更可能: 1分～999分
- 実行中は変更不可

#### 3.1.2 タイマー制御
| ボタン | 機能 | 状態 |
|--------|------|------|
| Start | タイマー開始 | 停止中のみ有効 |
| Stop | タイマー停止 | 実行中のみ有効 |
| Reset | タイマーリセット | 常に有効 |

#### 3.1.3 時間切れ処理
- 残り時間が0秒になると自動的にアラート表示
- タイマーは自動停止
- アラートメッセージ: 「時間切れです！」

### 3.2 問題表示機能

#### 3.2.1 問題構成
各問題は以下の要素で構成:
- 問題番号（1～15）
- 問題文
- 勘定科目選択肢（A, B, C, D の4つ）
- 回答入力欄
  - 借方記号（A-D）
  - 借方金額（数値）
  - 貸方記号（A-D）
  - 貸方金額（数値）

#### 3.2.2 入力仕様
- 記号入力: 自動で大文字変換
- 金額入力: 数値のみ
- 入力データは自動保存（sessionStorage）

### 3.3 判定機能

#### 3.3.1 個別判定
- 各問題の「判定」ボタンをクリック
- 正解: ○ 正解（緑色）
- 不正解: × 不正解（赤色）
- 未入力: 判定なし

#### 3.3.2 全問題判定
- 「全問題を判定」ボタンをクリック
- 全15問を一括判定
- 正解数をアラートで表示
  - 例: 「判定完了！ 12 / 15 問正解」

#### 3.3.3 判定ロジック
以下の条件を全て満たす場合に正解:
1. 借方記号が正解と一致
2. 借方金額が正解と一致
3. 貸方記号が正解と一致
4. 貸方金額が正解と一致

未入力がある場合は判定対象外。

### 3.4 正解・解説表示機能

#### 3.4.1 遷移
- 各問題の「正解」ボタンをクリック
- 別ページに遷移

#### 3.4.2 表示内容
- 問題文
- 正解の仕訳（表形式）
  - 借方勘定科目・金額
  - 貸方勘定科目・金額
- 解説文
- 「問題一覧に戻る」ボタン

#### 3.4.3 データ保持
- 正解ページから戻った際も入力データは保持される

### 3.5 問題更新機能

#### 3.5.1 問題生成
- 「問題の更新」ボタンをクリック
- Gemini APIを呼び出して新しい15問を生成
- 生成中は「更新中...」と表示
- ボタンは無効化

#### 3.5.2 成功時
- 問題を新しいものに差し替え
- 回答・判定結果をクリア
- アラート表示: 「問題を更新しました！」

#### 3.5.3 失敗時
- 既存の問題は維持
- アラート表示: 「更新できません」
- エラー原因:
  - APIキー未設定
  - ネットワークエラー
  - API制限超過

### 3.6 解答クリア機能
- 「解答クリア」ボタンをクリック
- 全ての入力データをクリア
- 全ての判定結果をクリア
- 問題はそのまま維持

---

## 4. 画面仕様

### 4.1 レイアウト構成

```
┌─────────────────────────────────────────┐
│ [左サイドバー]    │ [メインコンテンツ]  │
│ (固定)            │ (スクロール可能)    │
│                   │                      │
│ ■ タイマー設定    │ ■ 問題1              │
│ ■ Start/Stop/Reset│ ■ 問題2              │
│ ■ 残り時間表示    │ ■ 問題3              │
│                   │  ...                 │
│ ─────────────     │ ■ 問題15             │
│ ■ 全問題を判定    │                      │
│ ■ 解答クリア      │                      │
│ ■ 問題の更新      │                      │
└─────────────────────────────────────────┘
```

### 4.2 左サイドバー（固定）

#### サイズ
- 幅: 320px (20rem)
- 高さ: 画面全体
- 背景: 白色
- 右ボーダー: グレー

#### 要素
1. **タイトル**: 「タイマー・判定」
2. **制限時間入力欄**
   - ラベル: 制限時間（分）
   - 入力: number型
   - デフォルト: 15
3. **タイマー制御ボタン**
   - Start（緑）/ Stop（黄）/ Reset（グレー）
   - 3つ横並び
4. **残り時間表示**
   - フォーマット: mm:ss
   - フォントサイズ: 大きめ
5. **全問題を判定ボタン**（紫色）
6. **解答クリアボタン**（赤色）
7. **問題の更新ボタン**（青色）

### 4.3 メインコンテンツ

#### レイアウト
- 左マージン: 320px（サイドバー分）
- パディング: 2rem
- 背景: グレー

#### 各問題カード
- 白背景
- ボーダー: グレー
- パディング: 1rem
- マージン下: 1rem
- 角丸

**構成:**
1. 問題番号（太字）
2. 問題文
3. 勘定科目一覧（横並び）
4. 借方・貸方入力欄（2列グリッド）
5. ボタン群（判定・正解）+ 判定結果表示

### 4.4 正解・解説ページ

#### レイアウト
- 最大幅: 768px
- 中央寄せ
- パディング: 2rem

#### 構成
1. **タイトル**: 問題X - 解答・解説
2. **問題セクション**
   - 見出し: 「問題」
   - 問題文表示
3. **正解の仕訳セクション**
   - 見出し: 「正解の仕訳」
   - テーブル形式
     | 借方 | 金額 | 貸方 | 金額 |
4. **解説セクション**
   - 見出し: 「解説」
   - 解説文
5. **戻るボタン**（青色）

---

## 5. API仕様

### 5.1 問題生成API

#### エンドポイント
```
POST /api/generate-problems
```

#### リクエスト
- パラメータなし
- 環境変数からAPIキーを取得

#### レスポンス

**成功時（200）:**
```json
{
  "problems": [
    {
      "id": 1,
      "question": "問題文",
      "accountOptions": [
        { "symbol": "A", "name": "勘定科目名" }
      ],
      "correctAnswer": {
        "debitSymbol": "A",
        "debitAmount": 100000,
        "creditSymbol": "B",
        "creditAmount": 100000
      },
      "explanation": "解説文"
    }
  ]
}
```

**失敗時（500）:**
```json
{
  "error": "Failed to generate problems"
}
```

#### 外部API呼び出し
- **URL**: `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent`
- **メソッド**: POST
- **認証**: クエリパラメータでAPIキー送信

**プロンプト仕様:**
- 日商簿記3級の仕訳問題を15問生成
- 各問題に4つの勘定科目選択肢
- JSON形式で出力
- 問題ID: 1～15

### 5.2 テストAPI（開発用）

#### エンドポイント
```
GET /api/test-gemini
```

#### 機能
- 利用可能なモデル一覧取得
- 簡単なテストリクエスト実行

#### レスポンス
```json
{
  "apiKey": "AIza...",
  "tests": {
    "listModels": { "success": true, "models": [...] },
    "geminiPro": { "success": false, ... },
    "gemini15Flash": { "success": false, ... }
  }
}
```

---

## 6. データ構造

### 6.1 型定義（TypeScript）

```typescript
// 勘定科目選択肢
interface AccountOption {
  symbol: string;  // A, B, C, D
  name: string;    // 勘定科目名
}

// 仕訳エントリ
interface JournalEntry {
  debitSymbol: string;   // 借方記号
  debitAmount: number;   // 借方金額
  creditSymbol: string;  // 貸方記号
  creditAmount: number;  // 貸方金額
}

// 問題
interface Problem {
  id: number;                        // 問題番号 1-15
  question: string;                  // 問題文
  accountOptions: AccountOption[];   // 勘定科目選択肢（4つ）
  correctAnswer: JournalEntry;       // 正解
  explanation: string;               // 解説
}

// ユーザー回答
interface UserAnswer {
  debitSymbol: string;   // 借方記号（入力値）
  debitAmount: string;   // 借方金額（入力値）
  creditSymbol: string;  // 貸方記号（入力値）
  creditAmount: string;  // 貸方金額（入力値）
}

// 判定結果
type JudgementResult = 'correct' | 'incorrect' | null;
```

### 6.2 デフォルト問題データ

**ファイル:** `data/problems.json`

**内容:**
- 15問の仕訳問題
- 現金取引中心
- 基本的な勘定科目を使用

### 6.3 sessionStorage

**保存データ:**
- `answers`: ユーザーの回答データ（JSON配列）
- `judgements`: 判定結果（JSON配列）

**ライフサイクル:**
- タブを閉じるまで保持
- リロードしても保持
- 別タブでは共有されない

---

## 7. 環境変数

### 7.1 必須環境変数

```bash
GEMINI_API_KEY=your_gemini_api_key
```

### 7.2 設定方法

#### ローカル開発
`.env.local` ファイルに記述

#### Vercel
- プロジェクト設定 > Environment Variables
- Name: `GEMINI_API_KEY`
- Value: APIキー

---

## 8. デプロイ仕様

### 8.1 ホスティング
- **プラットフォーム**: Vercel
- **ビルドコマンド**: `npm run build`
- **出力ディレクトリ**: `.next`

### 8.2 自動デプロイ
- GitHubのmainブランチへのpush時に自動デプロイ
- プレビューデプロイ: Pull Request作成時

### 8.3 本番URL
```
https://boki3-app.vercel.app
```

---

## 9. 制約事項

### 9.1 Gemini API制限（無料枠）
**注意**: 2025年12月にGoogleが無料枠を大幅に削減しました。

**gemini-2.5-flash モデル（現在使用中）**:
- 1分あたり: 10リクエスト (RPM)
- 1日あたり: **20リクエスト** (RPD) ※2025年12月変更
- トークン: 250,000トークン/分 (TPM)

**クォータリセット時刻**:
- 太平洋時間の0時（日本時間17時/冬時間、16時/夏時間）

**参考**: 以前は1日250リクエストでしたが、2025年12月7日の変更で20リクエストに削減されました。

### 9.2 ブラウザ対応
- Chrome（推奨）
- Firefox
- Safari
- Edge

### 9.3 画面サイズ
- 最小幅: 1024px（推奨）
- レスポンシブデザイン未対応

---

## 10. 今後の拡張案

### 10.1 機能拡張
- [ ] 問題の難易度選択
- [ ] 学習履歴の保存
- [ ] 正解率の統計表示
- [ ] 複数の試験種別対応（2級、1級）
- [ ] 問題のお気に入り機能

### 10.2 UI改善
- [ ] レスポンシブデザイン対応
- [ ] ダークモード対応
- [ ] キーボードショートカット
- [ ] アクセシビリティ向上

### 10.3 技術改善
- [ ] データベース導入（ユーザー管理）
- [ ] 認証機能（ログイン）
- [ ] PWA化（オフライン対応）
- [ ] テストコード追加

---

## 11. バージョン履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0.0 | 2025-XX-XX | 初回リリース |

---

## 12. ライセンス

Private

## 13. 連絡先

GitHub: https://github.com/koji0505/boki3-app
